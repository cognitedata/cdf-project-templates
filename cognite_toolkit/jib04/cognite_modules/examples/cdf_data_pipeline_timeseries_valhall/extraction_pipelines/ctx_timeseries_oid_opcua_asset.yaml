externalId: 'ep_ctx_timeseries_{{location_name}}_{{source_name}}_asset'
name: 'ctx:timeseries:{{location_name}}:{{source_name}}:asset'
dataSetExternalId: 'ds_timeseries_{{location_name}}'
description: 'Contextualization of time series and assets for  {{location_name}}:{{source_name}}'
rawTables:
  - dbName: 'timeseries_{{location_name}}_{{source_name}}'
    tableName: 'contextualization_good'
  - dbName: 'timeseries_{{location_name}}_{{source_name}}'
    tableName: 'contextualization_bad'
  - dbName: 'timeseries_{{location_name}}_{{source_name}}'
    tableName: 'contextualization_manual_input'

source: '{{source_name}}'
documentation: >
  # Time series and assets Contextualization

  The Time series and assets Contextualization runs as a process in CDF Functions. Process triggers on new time series that not is connected to an asset. The process stages are as follows:

  ```
   1. Read all time series not matched (or all if runAll is True)
   2. Read all assets 
   3. Read and apply any defined manual matches defined in RAW table (table: contextualization_manual_input) 
   4. Run ML contextualization to match TS -> Assets 
   5. Update TS with mapping 
   6. Write results matched (good) not matched (bad) to RAW
  ```  

  Default configuration is provided as part of the deployment, but can be overwritten by configuration provided in configuration section below:
  
  ```
   # if True, run without writing any annotations to CDF
   debug: False
   # if True run contextualization on all time series, if False only run on time series that not is linked to an asset
   runAll: False
   # RAW DB used to store input and results for contextualization
   rawdb: 'timeseries_oid_opcua'
   # RAW table used to store all manual input for mapping that should be used in contextualization
   # This table could be poulated from earier mappings that are approved or used for manual override
   rawTableManual: 'contextualization_manual_input'
   # RAW table used to store all mapping that was automatically approved as good
   rawTableGood: 'contextualization_good'
   # RAW table used to store all mapping that NOT was automatically approved
   rawTableBad: 'contextualization_bad'
   # Prefix used for all time series that is used in contextualization
   timeSereisPrefix: "pi_"
   # List of externalId for root assets to be used for contextualization
   assetRootExtIds: [workmate:VAL]
   # Number between 0 and 1, indication of strict the matching should be 1 = only exact matches
   matchThreshold: 0.85
  ```